<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMGE 430 Project 1</title>
    <link rel="stylesheet" type="text/css" href="/style.css">

    <script>
        
        const handleResponse=async (response, parseResponse)=>{
            const content = document.querySelector('#content');

            switch(response.status){
                case 200:
                    content.innerHTML=`<b>Success</b>`;
                    break;
                default:
                    content.innerHTML=`<b>Error code not implemented</b>`;
                    break;
            }

            if(parseResponse){
                let obj = await response.json();
                // console.log(obj);
                //let num = Math.round(Math.random()*250);
                let jsonString = JSON.stringify(obj);
                content.innerHTML+=`<p>${jsonString}</p>`;
            }


        }

        const requestUpdate=async (countryForm)=>{
            let url = countryForm.querySelector('#urlField').value;
            const method = countryForm.querySelector('#methodSelect').value;
            const name = countryForm.querySelector('#nameField').value;
            url+=`?name=${name}`;
            console.log(url);

                let response = await fetch(url,{
                    method,
                    headers:{
                        'Accept':'application/json'
                    },
                });

             handleResponse(response, method === 'get');
        }

        const init =()=>{
            const countryForm = document.querySelector('#countryForm');

            const getCountry=(e)=>{
                e.preventDefault();
                requestUpdate(countryForm);
                return false;
            }

            countryForm.addEventListener('submit',getCountry);
        }
        window.onload=init;
    </script>
</head>
<body>
    <section id="top">
    <h3>IGME 430 PROJECT 1 COUNTRIES</h3>
    <!-- <form id="nameForm" action="/addUser" method="post">
      <label for="name">Name: </label>
      <input id="nameField" type="text" name="name" />
      <label for="age">Age: </label>
      <input id="ageField" type="number" name="age" min="0" max="100" step="1"/>
      <input type="submit" value="Add User" />
    </form> -->
    <form id="countryForm" action="/getCountries" method="get">
      <select id='urlField'>
        <option value='/getCountries'>/getCountries</option>
        <!-- <option value='/notReal'>/notReal</option> -->
      </select>
      <select id="methodSelect">
        <option value="get">GET</option>
        <option value="head">HEAD</option>
      </select>
      <label for="name">Name:</label>
      <input id="nameField" type="text" name="name"/>
      <input type="submit" value="Get Country" />
    </form>
  </section>
  <section id="content">
  </section>
</body>
</html>