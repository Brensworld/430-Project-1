<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMGE 430 Project 1</title>
    <link rel="stylesheet" type="text/css" href="/style.css">

    <script>
        
        const handleResponse=async (response, parseResponse, url)=>{
            const content = document.querySelector('#content');

            switch(response.status){
                case 200:
                    content.innerHTML=`<b>Success</b>`;
                    break;
                case 201:
                    content.innerHTML=`<b>Created</b>`;
                    break;
                case 204:
                    content.innerHTML=`<b>Updated</b>`;
                    break;
                case 400:
                    content.innerHTML=`<b>Bad Request</b>`;
                    break;
                case 404:
                    content.innerHTML=`<b>Not Found</b>`;
                    break;
                default:
                    content.innerHTML=`<b>Error code not implemented</b>`;
                    break;
            }

            if(parseResponse){
                let obj = await response.json();
                let keys =Object.keys(obj);
                //console.log(keys);
                //let num = Math.round(Math.random()*250);
                for(let i=0;i<keys.length;i++){
                    let jsonString='';
                    if(url.includes('/getCountries')){
                        jsonString = JSON.stringify(obj[keys[i]].countryName);
                        content.innerHTML+=`<p><a href=${jsonString}>${jsonString}</a></p>`;
                    }
                    else if(url.includes('/getSubregions')){
                        jsonString=JSON.stringify(obj[keys[i]].countrySubregion);
                        content.innerHTML+=`<p>${jsonString}</p>`;
                    }
                    else if(url.includes('/getTimezones')){
                        jsonString=JSON.stringify(obj[keys[i]]);
                        content.innerHTML+=`<p>${jsonString}</p>`;
                    }
                    else if(url.includes('/getCapitals')){
                        jsonString=JSON.stringify(obj[keys[i]]);
                        content.innerHTML+=`<p>${jsonString}</p>`;
                    }
                    
                }
                

                //console.log(obj.length);
            }else{
                content.innerHTML+=`<p>from ${url}</p>`;
            }


        }

        const requestUpdate=async (countryForm)=>{
            let url = countryForm.querySelector('#urlField').value;
            const method = countryForm.querySelector('#methodSelect').value;
            const name = countryForm.querySelector('#nameField').value;
            const region = countryForm.querySelector('#regionSelect').value;
            url+=`?name=${name}`;

            url+=`&region=${region}`;
            
            console.log(url);

                let response = await fetch(url,{
                    method,
                    headers:{
                        'Accept':'application/json'
                    },
                });

             handleResponse(response, method === 'get', url);
        }

        const sendPost = async (addForm)=>{
            let url = addForm.querySelector('#urlField').value;
            const method = addForm.getAttribute('method');

            const name = addForm.querySelector('#nameField').value;
            const region=addForm.querySelector('#regionSelect').value;
            

            const formData=`name=${name}&region=${region}`;

            const response =await fetch(url,{
                method:method,
                headers:{
                    'Content-Type':'application/x-www-form-urlencoded',
                    'Accept':'application/json',
                },
                body:formData,
            });

            handleResponse(response);
        }

        const init =()=>{
            const countryForm = document.querySelector('#countryForm');
            const addForm = document.querySelector('#addForm');

            const getCountry=(e)=>{
                e.preventDefault();
                requestUpdate(countryForm);
                return false;
            }

            const addCountry = (e)=>{
                e.preventDefault();
                sendPost(addForm);
                return false;
            }

            countryForm.addEventListener('submit',getCountry);
            addForm.addEventListener('submit', addCountry);
        }
        window.onload=init;
    </script>
</head>
<body>
    <section id="top">
    <h3>IGME 430 PROJECT 1 COUNTRIES</h3>
    <!-- <form id="nameForm" action="/addUser" method="post">
      <label for="name">Name: </label>
      <input id="nameField" type="text" name="name" />
      <label for="age">Age: </label>
      <input id="ageField" type="number" name="age" min="0" max="100" step="1"/>
      <input type="submit" value="Add User" />
    </form> -->
    <form id="countryForm" action="/getCountries" method="get">
      <select id='urlField'>
        <option value='/getCountries'>/getCountries</option>
        <option value="/getSubregions">/getSubregions</option>
        <option value="/getTimezones">/getTimezones</option>
        <option valie="/getCapitals">/getCapitals</option>
        <!-- <option value='/notReal'>/notReal</option> -->
      </select>
      <select id="methodSelect">
        <option value="get">GET</option>
        <option value="head">HEAD</option>
      </select>
      <label for="name">Country Name:</label>
      <input id="nameField" type="text" name="name"/>
      <input type="submit" value="Get Items"  />
      <label for="region">Region:</label>
      <select id="regionSelect" name="region">
        <option value="None">None</option>
        <option value="Asia">Asia</option>
        <option value="Europe">Europe</option>
        <option value="Oceania">Oceania</option>
        <option value="Africa">Africa</option>
        <option value="Americas">Americas</option>
        <option value="Polar">Polar</option>
        <option value="Other">Other</option>
      </select>
    </form>
    <form id="addForm" action="/addCountry" method="post">
        <select id="urlField">
            <option value="/addCountry">/addCountry</option>
        </select>
        <label for="name">New Name:</label>
        <input id="nameField" type="text" name="name"/>
        <select id="regionSelect">
            <option value="Asia">Asia</option>
            <option value="Europe">Europe</option>
            <option value="Oceania">Oceania</option>
            <option value="Africa">Africa</option>
            <option value="Americas">Americas</option>
            <option value="Polar">Polar</option>
            <option value="Other">Other</option>
      </select>
      <input type="submit" value="Submit"  />
    </form>
  </section>
  <section id="content">
  </section>
</body>
</html>